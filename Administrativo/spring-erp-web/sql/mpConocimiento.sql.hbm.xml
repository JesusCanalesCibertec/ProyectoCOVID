<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>

  <sql-query name="mpConocimiento.filtroContar">

	 SELECT
			COUNT(1)
			FROM minedu.CONOCIMIENTO T1
			LEFT JOIN MA_MISCELANEOSDETALLE MA1 ON T1.TIPO = MA1.CODIGOELEMENTO AND MA1.CODIGOTABLA = 'TIPOCON' AND MA1.COMPANIA = '000200' AND MA1.ESTADO = 'A'
			LEFT JOIN MA_MISCELANEOSDETALLE MA2 ON T1.AREA = MA2.CODIGOELEMENTO AND MA2.CODIGOTABLA = 'AREATCON' AND MA2.COMPANIA = '000200' AND MA2.ESTADO = 'A'
			LEFT JOIN MA_MISCELANEOSDETALLE MA3 ON T1.AREA = MA3.CODIGOELEMENTO AND MA3.CODIGOTABLA = 'AREAMCON' AND MA3.COMPANIA = '000200' AND MA3.ESTADO = 'A'
			where
		T1.NOMBRE like isnull(:p_nombre, T1.NOMBRE) + '%' COLLATE Latin1_General_CI_AI and 
		ISNULL(T1.TIPO, '') = isnull(:p_tipo, ISNULL(T1.TIPO, '')) AND 
		ISNULL(T1.AREA, '') = isnull(:p_area, ISNULL(T1.AREA, '')) AND
		ISNULL(T1.ESTADO, '') = isnull(:p_estado, ISNULL(T1.ESTADO, ''))


  </sql-query>




  <sql-query name="mpConocimiento.filtroPaginacion">

	 
	  SELECT
			T1.ID_CONOCIMIENTO,
			MA1.DESCRIPCIONLOCAL AS 'Tipo',
			case T1.TIPO
			when 'T' then MA2.DESCRIPCIONLOCAL 
			else MA3.DESCRIPCIONLOCAL
			END as '√Årea',
			T1.NOMBRE,
			T1.DESCRIPCION,
			T1.ESTADO,
			case T1.TIPO
			when 'T' then MA1.DESCRIPCIONLOCAL+' - '+MA2.DESCRIPCIONLOCAL
			else MA1.DESCRIPCIONLOCAL END as CABECERA,
			ROW_NUMBER() OVER (ORDER BY T1.ID_CONOCIMIENTO desc) AS Seq
			FROM minedu.CONOCIMIENTO T1
			LEFT JOIN MA_MISCELANEOSDETALLE MA1 ON T1.TIPO = MA1.CODIGOELEMENTO AND MA1.CODIGOTABLA = 'TIPOCON' AND MA1.COMPANIA = '000200' AND MA1.ESTADO = 'A'
			LEFT JOIN MA_MISCELANEOSDETALLE MA2 ON T1.AREA = MA2.CODIGOELEMENTO AND MA2.CODIGOTABLA = 'AREATCON' AND MA2.COMPANIA = '000200' AND MA2.ESTADO = 'A'
			LEFT JOIN MA_MISCELANEOSDETALLE MA3 ON T1.AREA = MA3.CODIGOELEMENTO AND MA3.CODIGOTABLA = 'AREAMCON' AND MA3.COMPANIA = '000200' AND MA3.ESTADO = 'A'
			where
		T1.NOMBRE like '%'+ isnull(:p_nombre, T1.NOMBRE) + '%' COLLATE Latin1_General_CI_AI and 
		ISNULL(T1.TIPO, '') = isnull(:p_tipo, ISNULL(T1.TIPO, '')) AND 
		ISNULL(T1.AREA, '') = isnull(:p_area, ISNULL(T1.AREA, '')) AND
		ISNULL(T1.ESTADO, '') = isnull(:p_estado, ISNULL(T1.ESTADO, ''))

		
 
  </sql-query>


</hibernate-mapping>
