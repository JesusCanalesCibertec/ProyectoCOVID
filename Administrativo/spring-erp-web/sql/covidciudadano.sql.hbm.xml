<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
  <sql-query name="covidciudadano.filtroContar">
	SELECT 
		COUNT(1)
		FROM CIUDADANO C
		INNER JOIN PAIS P ON P.ID_PAIS = C.ID_PAIS
		INNER JOIN DEPARTAMENTO DEP	ON DEP.ID_DEPARTAMENTO = C.ID_DEPARTAMENTO
		INNER JOIN PROVINCIA PRO	ON PRO.ID_PROVINCIA = C.ID_PROVINCIA AND PRO.ID_DEPARTAMENTO = C.ID_DEPARTAMENTO
		INNER JOIN DISTRITO DIS		ON DIS.ID_DISTRITO = C.ID_DISTRITO AND DIS.ID_PROVINCIA = C.ID_PROVINCIA AND DIS.ID_DEPARTAMENTO = C.ID_DEPARTAMENTO
		where
		C.NRO_DOC like '%'+ isnull(:p_documento, C.NRO_DOC) + '%' and 
		(C.NOM_CIUDADANO  like '%' + isnull(:p_nombre, C.NOM_CIUDADANO) + '%' OR C.APE_CIUDADANO like '%' + isnull(:p_nombre, C.APE_CIUDADANO) + '%') AND
		C.ID_PAIS = ISNULL(:p_pais, C.ID_PAIS) AND 
		C.ID_DEPARTAMENTO = ISNULL(:p_departamento, C.ID_DEPARTAMENTO) AND 
		C.ID_PROVINCIA = ISNULL(:p_provincia, C.ID_PROVINCIA) AND 
		C.ID_DISTRITO = ISNULL(:p_distrito, C.ID_DISTRITO) AND 
		C.ESTADO = ISNULL(:p_estado, C.ESTADO)	
  </sql-query>
  <sql-query name="covidciudadano.filtroPaginacion">	 
	SELECT 
		C.COD_CIUDADANO,
		C.NRO_DOC,
		C.NOM_CIUDADANO+' '+C.APE_CIUDADANO AS NOMBRECOMPLETO,
		C.ID_PAIS,
		P.DESCRIPCION AS NOM_PAIS,
		C.DIRECCION,
		C.ID_DEPARTAMENTO,
		DEP.DESCRIPCION AS NOMDEPARTAMENTO,
		C.ID_PROVINCIA,
		PRO.DESCRIPCION AS NOMPROVINCIA,
		C.ID_DISTRITO,
		DIS.DESCRIPCION AS NOMDISTRITO,
		C.ESTADO,
		RES.NOM_ESTADO,
		DATEDIFF(yy,CONVERT(DATETIME, c.FECHA_NAC),GETDATE()) AS AGE,
		C.NOM_CIUDADANO AS NOMBRE,
		C.APE_CIUDADANO AS APELLIDO,
		(SELECT COUNT(1) FROM TRIAJE T WHERE T.COD_CIUDADANO = C.COD_CIUDADANO) AS CANTIDAD,
		ROW_NUMBER() OVER (ORDER BY C.COD_CIUDADANO desc) AS Seq
		FROM CIUDADANO C
		INNER JOIN PAIS P ON P.ID_PAIS = C.ID_PAIS
		INNER JOIN DEPARTAMENTO DEP	ON DEP.ID_DEPARTAMENTO = C.ID_DEPARTAMENTO
		INNER JOIN PROVINCIA PRO	ON PRO.ID_PROVINCIA = C.ID_PROVINCIA AND PRO.ID_DEPARTAMENTO = C.ID_DEPARTAMENTO
		INNER JOIN DISTRITO DIS		ON DIS.ID_DISTRITO = C.ID_DISTRITO AND DIS.ID_PROVINCIA = C.ID_PROVINCIA AND DIS.ID_DEPARTAMENTO = C.ID_DEPARTAMENTO
		INNER JOIN RESULTADO RES	ON RES.COD_ESTADO = C.ESTADO
	where
		C.NRO_DOC like '%'+ isnull(:p_documento, C.NRO_DOC) + '%' and 
		(C.NOM_CIUDADANO  like '%' + isnull(:p_nombre, C.NOM_CIUDADANO) + '%' OR C.APE_CIUDADANO like '%' + isnull(:p_nombre, C.APE_CIUDADANO) + '%') AND
		C.ID_PAIS = ISNULL(:p_pais, C.ID_PAIS) AND 
		C.ID_DEPARTAMENTO = ISNULL(:p_departamento, C.ID_DEPARTAMENTO) AND 
		C.ID_PROVINCIA = ISNULL(:p_provincia, C.ID_PROVINCIA) AND 
		C.ID_DISTRITO = ISNULL(:p_distrito, C.ID_DISTRITO) AND 
		C.ESTADO = ISNULL(:p_estado, C.ESTADO)	
  </sql-query>
</hibernate-mapping>
